<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ú˜Ù†Ø±Ø§ØªÙˆØ± Ù…Ø­ØªÙˆØ§ÛŒ HTML Ù¾ÛŒØ´Ø±ÙØªÙ‡</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.4.4/lz-string.min.js"></script>

    <style id="base-styles">
        /* Base Styles (Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ±) */
        body { font-family: Tahoma, 'B Titr', Arial, sans-serif; padding: 20px; background-color: #f4f4f4; margin: 0; }
        .main-container { display: flex; max-width: 1400px; margin: 0 auto; gap: 20px; }
        .controls { flex: 1; padding: 20px; border: 1px solid #ddd; border-radius: 8px; background-color: #fff; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .preview-area { flex: 2; min-height: 500px; padding: 20px; border: 1px solid #ddd; border-radius: 8px; background-color: #fff; overflow-y: auto; }
        .output-actions { width: 100%; max-width: 1400px; margin: 20px auto; text-align: center; }
        label { display: block; margin-top: 15px; font-weight: bold; color: #333; }
        input[type="text"], input[type="number"], select, textarea { width: 100%; padding: 10px; margin-top: 5px; box-sizing: border-box; border: 1px solid #ccc; border-radius: 4px; }
        .add-btn, .action-btn { padding: 10px 18px; margin-top: 20px; cursor: pointer; border: none; border-radius: 4px; color: white; transition: background-color 0.3s; }
        .add-btn { background-color: #007BFF; width: 100%; }
        .add-btn:hover { background-color: #0056b3; }
        .action-btn { margin: 0 5px; }
        .page-element { 
            padding: 15px; margin-bottom: 10px; border: 1px dashed #ccc; background-color: #f9f9f9; 
            display: flex; align-items: flex-start; justify-content: space-between;
        }
        .element-content { flex-grow: 1; margin-left: 10px; }
        .element-controls button { font-size: 12px; padding: 5px 10px; margin-bottom: 5px; display: block; background-color: #ffc107; color: #333; border: none; border-radius: 4px; cursor: pointer; }
        .element-controls .delete-btn { background-color: #dc3545; color: white; }
        .card { border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .card img { max-width: 100px; height: auto; float: right; margin-right: 15px; border-radius: 4px; }
        .card-body { overflow: hidden; }
        .spacer-preview { background-color: #e6e6e6; text-align: center; color: #666; font-size: 12px; line-height: 1; padding-top: 5px; border: 1px solid #ccc; }
        .modal-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.6); 
            display: none; justify-content: center; align-items: center; z-index: 1000;
        }
        .modal-content {
            background: #fff; padding: 30px; border-radius: 10px; width: 90%; max-width: 600px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3); text-align: right;
        }
        .modal-link-box {
            background: #f0f0f0; padding: 10px; border-radius: 5px; 
            overflow-x: auto; font-family: monospace; font-size: 14px;
            margin: 15px 0; border: 1px solid #ccc;
        }
        .copy-btn { background-color: #28a745; margin-top: 10px; margin-left: 10px; }
        .close-btn { background-color: #6c757d; margin-top: 10px; }
        .hidden-control { display: none; }
    </style>
</head>
<body onload="loadFromLink()">

    <h1 id="main-title" style="text-align: center; margin-bottom: 30px;">Ú˜Ù†Ø±Ø§ØªÙˆØ± Ù…Ø­ØªÙˆØ§ÛŒ HTML Ù¾ÛŒØ´Ø±ÙØªÙ‡</h1>

    <div class="main-container" id="editor-container">
        <div class="controls">
            <h2>ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§Ù„Ù…Ø§Ù†</h2>
            <label for="element-type">Ø§Ù†ØªØ®Ø§Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ù…Ø§Ù†:</label>
            <select id="element-type" onchange="updateControls()">
                <option value="button">Ø¯Ú©Ù…Ù‡ (Button)</option>
                <option value="input_field">Ø¬Ø§ÛŒ ÙˆØ§Ø±Ø¯ Ú©Ø±Ø¯Ù† Ù…ØªÙ† (Input)</option>
                <option value="spacer">ÙØ§ØµÙ„Ù‡â€ŒØ¯Ù‡Ù†Ø¯Ù‡ (Spacer)</option>
                <option value="title">Ø¹Ù†ÙˆØ§Ù† (h2)</option>
                <option value="paragraph">Ù¾Ø§Ø±Ø§Ú¯Ø±Ø§Ù</option>
                <option value="image">ØªØµÙˆÛŒØ± (Image)</option>
                <option value="video">ÙˆÛŒØ¯ÛŒÙˆÛŒ Embed</option>
                <option value="table">Ø¬Ø¯ÙˆÙ„ Ø³Ø§Ø¯Ù‡</option>
                <option value="list">Ù„ÛŒØ³Øª Ø¨ÙˆÙ„Øªâ€ŒØ¯Ø§Ø±</option>
                <option value="card">Ú©Ø§Ø±Øª (Card)</option>
                <option value="file_link">Ù„ÛŒÙ†Ú© ÙØ§ÛŒÙ„ ÛŒØ§ Ø¯Ø§Ù†Ù„ÙˆØ¯</option>
            </select>
            
            <div id="common-controls">
                <label for="element-content" id="label-content">Ù…ØªÙ† Ø§Ù„Ù…Ø§Ù†:</label>
                <textarea id="element-content">Ø§ÛŒÙ† ÛŒÚ© Ø¯Ú©Ù…Ù‡ Ø§Ø³Øª.</textarea>

                <label for="element-link" id="label-link">Ù„ÛŒÙ†Ú© (URL/Ø¢Ø¯Ø±Ø³):</label>
                <input type="text" id="element-link" placeholder="http://example.com/..." value="#">
            </div>

            <div id="style-controls">
                <h3 style="margin-top: 25px;">ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§Ø³ØªØ§ÛŒÙ„ Ùˆ Ø¹Ù…Ù„Ú©Ø±Ø¯</h3>

                <div id="button-styles" class="hidden-control">
                    <label for="color-main">Ø±Ù†Ú¯ Ø§ØµÙ„ÛŒ Ø¯Ú©Ù…Ù‡:</label><input type="color" id="color-main" value="#007BFF">
                    <label for="color-hover">Ø±Ù†Ú¯ Ø¯Ø± Ù‡Ø§ÙˆØ± (Hover):</label><input type="color" id="color-hover" value="#0056b3">
                    <label for="color-text">Ø±Ù†Ú¯ Ù…ØªÙ† Ø¯Ú©Ù…Ù‡:</label><input type="color" id="color-text" value="#FFFFFF">
                    <label for="button-action">Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø¯Ú©Ù…Ù‡:</label>
                    <select id="button-action">
                        <option value="link">Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ù„ÛŒÙ†Ú©/ØµÙØ­Ù‡</option>
                        <option value="alert">Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØºØ§Ù… (Alert)</option>
                    </select>
                </div>

                <div id="input-controls" class="hidden-control">
                    <label for="input-placeholder">Ù…ØªÙ† Ù¾ÛŒØ´â€ŒÙØ±Ø¶ (Placeholder):</label>
                    <input type="text" id="input-placeholder" value="Ù…ØªÙ† Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯...">
                </div>

                <div id="spacer-controls" class="hidden-control">
                    <label for="spacer-height">Ø§Ø±ØªÙØ§Ø¹ ÙØ§ØµÙ„Ù‡â€ŒØ¯Ù‡Ù†Ø¯Ù‡ (px):</label>
                    <input type="number" id="spacer-height" value="30" min="5">
                </div>

                <div id="text-styles" class="hidden-control">
                    <label for="text-size">Ø§Ù†Ø¯Ø§Ø²Ù‡ Ù…ØªÙ† (ÙÙˆÙ†Øª):</label>
                    <select id="text-size">
                        <option value="normal">Ù…ØªÙˆØ³Ø· (16px)</option>
                        <option value="large">Ø¨Ø²Ø±Ú¯ (20px)</option>
                        <option value="small">Ú©ÙˆÚ†Ú© (14px)</option>
                    </select>
                    <label for="text-color">Ø±Ù†Ú¯ Ù…ØªÙ†:</label><input type="color" id="text-color-value" value="#333333">
                </div>
                
                <div id="table-controls" class="hidden-control">
                    <label for="table-rows">ØªØ¹Ø¯Ø§Ø¯ Ø³Ø·Ø±:</label><input type="number" id="table-rows" value="3" min="1">
                    <label for="table-cols">ØªØ¹Ø¯Ø§Ø¯ Ø³ØªÙˆÙ†:</label><input type="number" id="table-cols" value="2" min="1">
                    <p style="font-size: 12px; color: #666;">Ù…ØªÙ† Ø³Ù„ÙˆÙ„â€ŒÙ‡Ø§ Ø±Ø§ Ø¯Ø± Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´ ÙˆÛŒØ±Ø§ÛŒØ´ Ú©Ù†ÛŒØ¯.</p>
                </div>
            </div>
            
            <button class="add-btn" onclick="addElement()">Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø§Ù„Ù…Ø§Ù† Ø¨Ù‡ ØµÙØ­Ù‡</button>
        </div>

        <div class="preview-area" id="live-preview">
            <h2 style="color: #666; margin-top: 0;">Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´ Ø²Ù†Ø¯Ù‡ ØµÙØ­Ù‡</h2>
        </div>
    </div>

    <div class="output-actions">
        <button class="action-btn" onclick="downloadHtml()" style="background-color: #28a745;">Ø¯Ø§Ù†Ù„ÙˆØ¯ ÙØ§ÛŒÙ„ HTML Ù†Ù‡Ø§ÛŒÛŒ</button>
        <button class="action-btn" onclick="createShareableLink()" style="background-color: #ff9800;">Ø³Ø§Ø®Øª Ù„ÛŒÙ†Ú© Ø§Ø´ØªØ±Ø§Ú©â€ŒÚ¯Ø°Ø§Ø±ÛŒ (ÙØ´Ø±Ø¯Ù‡)</button>
        <button class="action-btn" onclick="clearContent()" style="background-color: #6c757d;">Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ØªÙ…Ø§Ù… Ù…Ø­ØªÙˆØ§</button>
    </div>

    <div id="content-viewer" style="display: none; padding: 0;">
        </div>
    
    <div id="link-modal" class="modal-overlay" onclick="hideModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <h3 style="margin-top: 0;">Ù„ÛŒÙ†Ú© Ø§Ø´ØªØ±Ø§Ú©â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ù…Ø­ØªÙˆØ§ (ÙØ´Ø±Ø¯Ù‡ Ø´Ø¯Ù‡)</h3>
            <p style="color: #888; font-size: 14px;">Ø§ÛŒÙ† Ù„ÛŒÙ†Ú© Ø¨Ù‡ Ø¯Ù„ÛŒÙ„ ÙØ´Ø±Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒØŒ Ù†Ø³Ø¨Øª Ø¨Ù‡ Base64 Ø®Ø§Ù… Ø¨Ø³ÛŒØ§Ø± Ú©ÙˆØªØ§Ù‡â€ŒØªØ± Ø§Ø³Øª.</p>
            <div id="share-link-box" class="modal-link-box"></div>
            <button class="copy-btn" onclick="copyLink()">Ú©Ù¾ÛŒ Ú©Ø±Ø¯Ù† Ù„ÛŒÙ†Ú©</button>
            <button class="close-btn" onclick="hideModal()">Ø¨Ø³ØªÙ†</button>
        </div>
    </div>

    <script>
        // --- Ù…ØªØºÛŒØ±Ù‡Ø§ ---
        const livePreview = document.getElementById('live-preview');
        const spacerHeightInput = document.getElementById('spacer-height'); // ØªØºÛŒÛŒØ± Ù†Ø§Ù… Ù…ØªØºÛŒØ± Ø¨Ø±Ø§ÛŒ ÙˆØ¶ÙˆØ­ Ø¨ÛŒØ´ØªØ±
        const mainTitle = document.getElementById('main-title');
        const editorContainer = document.getElementById('editor-container');
        const outputActions = document.querySelector('.output-actions');
        const contentViewer = document.getElementById('content-viewer');

        // --- ØªÙˆØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ ---

        function updateControls() {
            const type = document.getElementById('element-type').value;
            
            document.querySelectorAll('#style-controls > div').forEach(div => div.classList.add('hidden-control'));
            document.getElementById('element-content').parentNode.style.display = 'block';
            document.getElementById('element-link').parentNode.style.display = 'block';

            if (type === 'button') {
                document.getElementById('button-styles').classList.remove('hidden-control');
            } else if (['title', 'paragraph', 'list'].includes(type)) {
                document.getElementById('text-styles').classList.remove('hidden-control');
            } else if (type === 'table') {
                document.getElementById('table-controls').classList.remove('hidden-control');
            } else if (type === 'input_field') {
                document.getElementById('input-controls').classList.remove('hidden-control');
                document.getElementById('element-content').parentNode.style.display = 'none';
                document.getElementById('element-link').parentNode.style.display = 'none';
            } else if (type === 'spacer') {
                document.getElementById('spacer-controls').classList.remove('hidden-control');
                document.getElementById('element-content').parentNode.style.display = 'none';
                document.getElementById('element-link').parentNode.style.display = 'none';
            }

            const labels = {
                'button': ['Ù…ØªÙ† Ø¯Ú©Ù…Ù‡:', 'Ù„ÛŒÙ†Ú© Ù…Ù‚ØµØ¯:'],
                'input_field': ['Ù†Ø§Ù… ÙÛŒÙ„Ø¯ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ):', ''],
                'spacer': ['', ''],
                'title': ['Ù…ØªÙ† Ø¹Ù†ÙˆØ§Ù†:', ''],
                'paragraph': ['Ù…ØªÙ† Ù¾Ø§Ø±Ø§Ú¯Ø±Ø§Ù:', ''],
                'image': ['Ù…ØªÙ† Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† (Alt):', 'Ø¢Ø¯Ø±Ø³ ØªØµÙˆÛŒØ± (URL):'],
                'video': ['Ø¹Ù†ÙˆØ§Ù† ÙˆÛŒØ¯ÛŒÙˆ:', 'Ù„ÛŒÙ†Ú© ÛŒÙˆØªÛŒÙˆØ¨/Ø¢Ù¾Ø§Ø±Ø§Øª:'],
                'table': ['Ø¹Ù†ÙˆØ§Ù† Ø¬Ø¯ÙˆÙ„:', ''],
                'list': ['Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§ÛŒ Ù„ÛŒØ³Øª (Ø¨Ø§ Ø®Ø· Ø¬Ø¯ÛŒØ¯ Ø¬Ø¯Ø§ Ú©Ù†ÛŒØ¯):', ''],
                'card': ['Ø¹Ù†ÙˆØ§Ù† Ú©Ø§Ø±Øª:', 'Ø¢Ø¯Ø±Ø³ ØªØµÙˆÛŒØ± Ú©Ø§Ø±Øª:'],
                'file_link': ['Ù†Ø§Ù… ÙØ§ÛŒÙ„:', 'Ù„ÛŒÙ†Ú© Ø¯Ø§Ù†Ù„ÙˆØ¯ ÙØ§ÛŒÙ„:']
            };

            const linkNeeded = labels[type] && labels[type][1];
            const contentNeeded = labels[type] && labels[type][0];
            
            if (type !== 'spacer' && type !== 'input_field') {
                document.getElementById('label-content').textContent = contentNeeded;
                document.getElementById('label-link').textContent = linkNeeded;
                document.getElementById('element-link').parentNode.style.display = linkNeeded ? 'block' : 'none';
                document.getElementById('element-content').parentNode.style.display = contentNeeded ? 'block' : 'none';
            }
        }
        
        function updateHtmlData(elementWrapper) {
            const contentDiv = elementWrapper.querySelector('.element-content');
            
            // Ø§Ú¯Ø± Ø§Ù„Ù…Ø§Ù† spacer Ù†ÛŒØ³ØªØŒ Ù…Ø­ØªÙˆØ§ÛŒ Ù†Ù‡Ø§ÛŒÛŒ Ø±Ø§ Ø§Ø² contenteditable Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ú©Ù†.
            if (!elementWrapper.querySelector('.spacer-preview')) {
                 elementWrapper.dataset.html = contentDiv.innerHTML;
            }
        }
        
        function moveElement(element, direction) {
            const currentContainer = element.parentNode;
            const elements = Array.from(currentContainer.querySelectorAll('.page-element'));
            const currentIndex = elements.indexOf(element);

            if (direction === 'up' && currentIndex > 0) {
                currentContainer.insertBefore(element, elements[currentIndex - 1]);
            } else if (direction === 'down' && currentIndex < elements.length - 1) {
                currentContainer.insertBefore(element, elements[currentIndex + 2]);
            }
        }
        
        function deleteElement(element) {
            element.remove();
        }

        function clearContent() {
            livePreview.innerHTML = '<h2 style="color: #666; margin-top: 0;">Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´ Ø²Ù†Ø¯Ù‡ ØµÙØ­Ù‡</h2>';
        }

        // --- ØªÙˆØ§Ø¨Ø¹ Ø§ØµÙ„ÛŒ ÙˆÛŒØ±Ø§ÛŒØ´Ú¯Ø± ---

        function addElement() {
            const type = document.getElementById('element-type').value;
            const content = document.getElementById('element-content').value || 'Ù…Ø­ØªÙˆØ§ÛŒ Ø®Ø§Ù„ÛŒ';
            const link = document.getElementById('element-link').value || '#';
            let htmlCode = '';

            const size = document.getElementById('text-size').value;
            const color = document.getElementById('text-color-value').value;
            let fontSize, h2Size;
            if (size === 'large') { fontSize = '18px'; h2Size = '28px'; }
            else if (size === 'small') { fontSize = '14px'; h2Size = '20px'; }
            else { fontSize = '16px'; h2Size = '24px'; }
            
            switch (type) {
                case 'button':
                    const colorMain = document.getElementById('color-main').value;
                    const colorHover = document.getElementById('color-hover').value;
                    const colorText = document.getElementById('color-text').value;
                    
                    const buttonHoverStyle = `onmouseover="this.style.backgroundColor='${colorHover}'" onmouseout="this.style.backgroundColor='${colorMain}'"`;
                    const buttonBaseStyle = `background-color: ${colorMain}; color: ${colorText}; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer;`;

                    if (document.getElementById('button-action').value === 'alert') {
                        htmlCode = `<button ${buttonHoverStyle} onclick="alert('${content} Ú©Ù„ÛŒÚ© Ø´Ø¯!')" style="${buttonBaseStyle}">${content}</button>`;
                    } else {
                        htmlCode = `<a href="${link}" target="_blank" ${buttonHoverStyle} style="text-decoration: none; display: inline-block; ${buttonBaseStyle}">${content}</a>`;
                    }
                    break;
                
                case 'input_field':
                    const placeholder = document.getElementById('input-placeholder').value;
                    htmlCode = `
                        <div style="margin: 15px 0;">
                            <label style="font-weight: normal; margin-bottom: 5px; display: block;">${content || 'Ú©Ø§Ø¯Ø± ÙˆØ±ÙˆØ¯ÛŒ'}:</label>
                            <input type="text" placeholder="${placeholder}" style="width: 100%; padding: 10px; box-sizing: border-box; border: 1px solid #ccc; border-radius: 4px;">
                        </div>
                    `;
                    break;
                
                case 'spacer':
                    const height = spacerHeightInput.value || 30;
                    htmlCode = `<div style="height: ${height}px;"></div>`;
                    break;

                case 'title':
                    htmlCode = `<h2 style="font-size: ${h2Size}; color: ${color}; margin: 15px 0;">${content}</h2>`;
                    break;

                case 'paragraph':
                    htmlCode = `<p style="font-size: ${fontSize}; color: ${color}; line-height: 1.6; margin: 15px 0;">${content}</p>`;
                    break;
                
                case 'image':
                    htmlCode = `<img src="${link}" alt="${content}" style="max-width: 100%; height: auto; display: block; margin: 15px 0; border-radius: 4px;">`;
                    break;

                case 'video':
                    let videoSrc = link;
                    if (link.includes('youtube.com/watch?v=')) { videoSrc = link.replace('watch?v=', 'embed/'); } 
                    else if (link.includes('youtu.be/')) { videoSrc = link.replace('youtu.be/', 'www.youtube.com/embed/'); }
                    
                    htmlCode = `
                        <div style="margin: 15px 0;">
                            <h3 style="color: #444;">${content}</h3>
                            <iframe width="560" height="315" src="${videoSrc}" frameborder="0" allowfullscreen style="max-width: 100%;"></iframe>
                        </div>
                    `;
                    break;
                
                case 'table':
                    const rows = parseInt(document.getElementById('table-rows').value) || 3;
                    const cols = parseInt(document.getElementById('table-cols').value) || 2;
                    let tableHtml = `<h3 style="color: #444;">${content}</h3><table style="width: 100%; border-collapse: collapse;"><thead><tr>`;
                    
                    for (let i = 0; i < cols; i++) { tableHtml += `<th style="border: 1px solid #ccc; padding: 8px; background-color: #f2f2f2;">Ø³Ø±Ø³ØªÙˆÙ† ${i + 1}</th>`; }
                    tableHtml += `</tr></thead><tbody>`;

                    for (let i = 0; i < rows; i++) {
                        tableHtml += `<tr>`;
                        for (let j = 0; j < cols; j++) {
                            tableHtml += `<td style="border: 1px solid #ccc; padding: 8px;" contenteditable="true">Ø±Ø¯ÛŒÙ ${i + 1}, Ø³ØªÙˆÙ† ${j + 1}</td>`;
                        }
                        tableHtml += `</tr>`;
                    }
                    tableHtml += `</tbody></table>`;
                    htmlCode = tableHtml;
                    break;

                case 'list':
                    const items = content.split('\n').filter(item => item.trim() !== '');
                    const listItems = items.map(item => `<li style="margin-right: 15px;">${item.trim()}</li>`).join('');
                    htmlCode = `<ul style="font-size: ${fontSize}; color: ${color}; margin: 15px 0; padding-right: 20px;">${listItems}</ul>`;
                    break;
                
                case 'card':
                    htmlCode = `
                        <div class="card">
                            <img src="${link}" alt="${content}" style="width: 100px; height: 100px; object-fit: cover;">
                            <div class="card-body">
                                <h3 style="margin-top: 0; color: #007BFF;">${content}</h3>
                                <p style="font-size: 14px; color: #555;">Ø§ÛŒÙ† Ù‚Ø³Ù…Øª Ø¨Ø±Ø§ÛŒ ØªÙˆØ¶ÛŒØ­ Ù…Ø­ØµÙˆÙ„ ÛŒØ§ Ø®Ø¯Ù…Ø§Øª Ø´Ù…Ø§Ø³Øª.</p>
                            </div>
                        </div>
                    `;
                    break;
                
                case 'file_link':
                    htmlCode = `<a href="${link}" download="${content}" style="display: block; margin: 10px 0; color: #007BFF; text-decoration: underline;">Ø¯Ø§Ù†Ù„ÙˆØ¯ ÙØ§ÛŒÙ„: ${content}</a>`;
                    break;

                default:
                    return;
            }

            const elementWrapper = document.createElement('div');
            elementWrapper.className = 'page-element';
            elementWrapper.dataset.html = htmlCode; 

            const isContentEditable = type !== 'table' && type !== 'spacer' && type !== 'input_field';
            const previewContent = type === 'spacer' ? `<div class="spacer-preview" style="height:${spacerHeightInput.value || 30}px;">ÙØ§ØµÙ„Ù‡â€ŒØ¯Ù‡Ù†Ø¯Ù‡ ${spacerHeightInput.value || 30}px</div>` : htmlCode;

            elementWrapper.innerHTML = `
                <div class="element-controls">
                    <button onclick="moveElement(this.parentNode.parentNode, 'up')">â–² Ø¨Ø§Ù„Ø§</button>
                    <button onclick="moveElement(this.parentNode.parentNode, 'down')">â–¼ Ù¾Ø§ÛŒÛŒÙ†</button>
                    <button class="delete-btn" onclick="deleteElement(this.parentNode.parentNode)">Ø­Ø°Ù</button>
                </div>
                <div class="element-content" contenteditable="${isContentEditable ? 'true' : 'false'}" onblur="updateHtmlData(this.parentNode)">${previewContent}</div>
            `;
            
            livePreview.appendChild(elementWrapper);
            livePreview.scrollTop = livePreview.scrollHeight;
        }

        /**
         * ğŸš¨ ØªØ§Ø¨Ø¹ Ø­ÛŒØ§ØªÛŒ Ø¨Ø±Ø§ÛŒ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ùˆ Ø³Ø§Ø®Øª Ù„ÛŒÙ†Ú© ğŸš¨
         * Ù…Ø­ØªÙˆØ§ÛŒ HTML Ù†Ù‡Ø§ÛŒÛŒ Ø±Ø§ Ø§Ø² ØªÙ…Ø§Ù… Ø§Ù„Ù…Ø§Ù†â€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´ Ø¬Ù…Ø¹â€ŒØ¢ÙˆØ±ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ø¯.
         */
        function getPageHtmlContent() {
             // 1. Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø§Ø² Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…Ø­ØªÙˆØ§ÛŒ ÙˆÛŒØ±Ø§ÛŒØ´ Ø´Ø¯Ù‡ Ø¯Ø± dataset.html
             Array.from(document.querySelectorAll('.page-element')).forEach(updateHtmlData);
            
            const elements = Array.from(document.querySelectorAll('.page-element'));
            if (elements.length === 0) {
                 alert("Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ Ú†Ù†Ø¯ Ø§Ù„Ù…Ø§Ù† Ø¨Ù‡ ØµÙØ­Ù‡ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯.");
                 return null;
            }
            
            // 2. Ø¬Ù…Ø¹â€ŒØ¢ÙˆØ±ÛŒ Ù…Ø­ØªÙˆØ§ÛŒ Ù†Ù‡Ø§ÛŒÛŒ
            const contentToDownload = elements.map(el => {
                // Ø§Ú¯Ø± Ø§Ù„Ù…Ø§Ù† spacer Ø§Ø³ØªØŒ ØªÚ¯ <div> Ø¨Ø§ Ø§Ø±ØªÙØ§Ø¹ ØµØ­ÛŒØ­ Ø±Ø§ Ø¨Ø±Ú¯Ø±Ø¯Ø§Ù†
                if (el.querySelector('.spacer-preview')) {
                     const height = el.querySelector('.spacer-preview').style.height.replace('px', '');
                     return `<div style="height: ${height}px;"></div>`;
                }
                // Ø¯Ø± ØºÛŒØ± Ø§ÛŒÙ† ØµÙˆØ±ØªØŒ Ù…Ø­ØªÙˆØ§ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡ Ø¯Ø± dataset.html Ø±Ø§ Ø¨Ø±Ú¯Ø±Ø¯Ø§Ù†
                return el.dataset.html;
            }).join('\n    ');

            return contentToDownload;
        }

        // --- ØªÙˆØ§Ø¨Ø¹ Ø³Ø§Ø®Øª Ù„ÛŒÙ†Ú© Ùˆ Ø¯Ø§Ù†Ù„ÙˆØ¯ ---

        function createShareableLink() {
            // ğŸš¨ Ø¨Ø±Ø±Ø³ÛŒ LZString ğŸš¨
            if (typeof LZString === 'undefined') {
                alert('Ø®Ø·Ø§: Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡ ÙØ´Ø±Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ LZString Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª. Ø§Ú¯Ø± Ø¢ÙÙ„Ø§ÛŒÙ† Ù‡Ø³ØªÛŒØ¯ØŒ ÙØ§ÛŒÙ„ Ø±Ø§ Ø¨Ù‡ ØµÙˆØ±Øª Ù…Ø­Ù„ÛŒ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú©Ù†ÛŒØ¯.');
                return;
            }
            
            const content = getPageHtmlContent();
            if (!content) return; // Ø§Ú¯Ø± Ù…Ø­ØªÙˆØ§ÛŒÛŒ Ù†Ø¨Ø§Ø´Ø¯ØŒ ØªÙˆÙ‚Ù Ú©Ù†.
            
            const compressedAndEncodedContent = LZString.compressToEncodedURIComponent(content);
            
            const baseUrl = window.location.origin + window.location.pathname;
            const shareableLink = baseUrl + '?data=' + compressedAndEncodedContent;

            showLinkModal(shareableLink);
        }

        function downloadHtml() {
            const contentToDownload = getPageHtmlContent();
            if (!contentToDownload) return; // Ø§Ú¯Ø± Ù…Ø­ØªÙˆØ§ÛŒÛŒ Ù†Ø¨Ø§Ø´Ø¯ØŒ ØªÙˆÙ‚Ù Ú©Ù†.
            
            const finalStyles = `
        body { font-family: Tahoma, 'B Titr', Arial, sans-serif; padding: 20px; line-height: 1.6; direction: rtl; text-align: right; }
        h2, h3, p { color: #333; margin: 15px 0; }
        .card { border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); overflow: auto; }
        .card img { float: right; margin-right: 15px; border-radius: 4px; object-fit: cover; }
        ul { margin: 15px 0; padding-right: 20px;}
        table { width: 100%; border-collapse: collapse; margin: 15px 0; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: right; }
        th { background-color: #f2f2f2; }
        a[download] { display: block; margin: 10px 0; color: #007BFF; text-decoration: underline; }
        input[type="text"] { width: 100%; padding: 10px; box-sizing: border-box; border: 1px solid #ccc; border-radius: 4px; }
    `;
            
            const finalHtml = `
<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØµÙØ­Ù‡ ØªÙˆÙ„ÛŒØ¯ Ø´Ø¯Ù‡</title>
    <style>
${finalStyles}
    </style>
</head>
<body>
    ${contentToDownload}
</body>
</html>
            `;
            
            const blob = new Blob([finalHtml], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'My_Advanced_WebPage.html';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // --- ØªÙˆØ§Ø¨Ø¹ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù„ÛŒÙ†Ú© (Load) ---

        function loadFromLink() {
            const urlParams = new URLSearchParams(window.location.search);
            const data = urlParams.get('data');

            if (data) {
                // Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† ÙˆÛŒØ±Ø§ÛŒØ´Ú¯Ø±
                mainTitle.style.display = 'none';
                editorContainer.style.display = 'none';
                outputActions.style.display = 'none';
                contentViewer.style.display = 'block';
                
                // ØªÙ†Ø¸ÛŒÙ… Ø§Ø³ØªØ§ÛŒÙ„ Ø¨Ø¯Ù†Ù‡ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ ØªÙ…Ø§Ù… ØµÙØ­Ù‡ Ù…Ø­ØªÙˆØ§
                document.body.style.padding = '0';
                document.body.style.backgroundColor = '#fff';

                try {
                    if (typeof LZString === 'undefined') {
                        throw new Error('LZString library not loaded. Check internet connection or load the file locally.');
                    }
                    
                    const decodedContent = LZString.decompressFromEncodedURIComponent(data);
                    
                    if (!decodedContent) {
                        throw new Error('Decompression failed or data is corrupted.');
                    }
                    
                    contentViewer.innerHTML = `
                        <div style="
                            max-width: 900px; 
                            margin: 0 auto; 
                            padding: 20px; 
                            direction: rtl; 
                            text-align: right;
                            font-family: Tahoma, 'B Titr', Arial, sans-serif;
                        ">
                            ${decodedContent}
                        </div>
                        <button onclick="window.location.href = window.location.pathname" style="
                            position: fixed; 
                            top: 15px; 
                            left: 15px; 
                            background-color: #f44336; 
                            color: white; 
                            border: none; 
                            padding: 8px 15px; 
                            border-radius: 4px; 
                            cursor: pointer; 
                            z-index: 9999;">
                            Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ ÙˆÛŒØ±Ø§ÛŒØ´Ú¯Ø±
                        </button>
                    `;
                    
                    contentViewer.style.padding = '20px';

                } catch (e) {
                    contentViewer.innerHTML = `
                        <div style="max-width: 900px; margin: 0 auto; padding: 20px;">
                            <p style="color: red; font-size: 18px;">âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ø­ØªÙˆØ§ Ø§Ø² Ù„ÛŒÙ†Ú©.</p>
                            <p style="direction: ltr; text-align: left; font-size: 14px; color: #666;">Ø¬Ø²Ø¦ÛŒØ§Øª: ${e.message}</p>
                        </div>
                        <button onclick="window.location.href = window.location.pathname" style="
                            position: fixed; top: 15px; left: 15px; background-color: #f44336; color: white; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer; z-index: 9999;">
                            Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ ÙˆÛŒØ±Ø§ÛŒØ´Ú¯Ø±
                        </button>
                    `;
                }
            } else {
                // Ø­Ø§Ù„Øª Ø¹Ø§Ø¯ÛŒ: Ù†Ù…Ø§ÛŒØ´ ÙˆÛŒØ±Ø§ÛŒØ´Ú¯Ø±
                mainTitle.style.display = 'block';
                editorContainer.style.display = 'flex';
                outputActions.style.display = 'block';
                contentViewer.style.display = 'none';
                document.body.style.padding = '20px';
                document.body.style.backgroundColor = '#f4f4f4';
            }
        }

        // --- ØªÙˆØ§Ø¨Ø¹ Modal Link (Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ±) ---

        function showLinkModal(link) {
            const modal = document.getElementById('link-modal');
            const linkBox = document.getElementById('share-link-box');
            linkBox.textContent = link;
            modal.style.display = 'flex';
        }

        function hideModal(event) {
            const modal = document.getElementById('link-modal');
            if (!event || event.target === modal || event.target.className === 'close-btn') {
                modal.style.display = 'none';
            }
        }

        function copyLink() {
            const linkBox = document.getElementById('share-link-box');
            const range = document.createRange();
            range.selectNode(linkBox);
            window.getSelection().removeAllRanges();
            window.getSelection().addRange(range);
            
            try {
                document.execCommand('copy');
                const copyButton = document.querySelector('.copy-btn');
                copyButton.textContent = 'âœ… Ú©Ù¾ÛŒ Ø´Ø¯!';
                copyButton.style.backgroundColor = '#17a2b8';
                
                setTimeout(() => {
                    copyButton.textContent = 'Ú©Ù¾ÛŒ Ú©Ø±Ø¯Ù† Ù„ÛŒÙ†Ú©';
                    copyButton.style.backgroundColor = '#28a745';
                }, 1500);

            } catch (err) {
                console.error('Failed to copy text: ', err);
            }
            window.getSelection().removeAllRanges();
        }
        
        updateControls();
    </script>
</body>
</html>
