<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>ژنراتور محتوای HTML پیشرفته</title>
    <style>
        /* Base Styles */
        body { font-family: Tahoma, sans-serif; padding: 20px; background-color: #f4f4f4; }
        .main-container { display: flex; max-width: 1400px; margin: 0 auto; gap: 20px; }
        .controls { flex: 1; padding: 20px; border: 1px solid #ddd; border-radius: 8px; background-color: #fff; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .preview-area { flex: 2; min-height: 500px; padding: 20px; border: 1px solid #ddd; border-radius: 8px; background-color: #fff; overflow-y: auto; }
        .output-actions { width: 100%; max-width: 1400px; margin: 20px auto; text-align: center; }

        /* Control Inputs */
        label { display: block; margin-top: 15px; font-weight: bold; color: #333; }
        input[type="text"], input[type="number"], select, textarea { width: 100%; padding: 10px; margin-top: 5px; box-sizing: border-box; border: 1px solid #ccc; border-radius: 4px; }
        .add-btn { padding: 10px 18px; margin-top: 20px; cursor: pointer; border: none; border-radius: 4px; background-color: #007BFF; color: white; width: 100%; }
        .add-btn:hover { background-color: #0056b3; }

        /* Live Element Styles & Controls */
        .page-element { 
            padding: 15px; 
            margin-bottom: 10px; 
            border: 1px dashed #ccc; 
            background-color: #f9f9f9; 
            display: flex; 
            align-items: flex-start;
            justify-content: space-between;
        }
        .element-content { flex-grow: 1; margin-left: 10px; }
        .element-controls button { font-size: 12px; padding: 5px 10px; margin-bottom: 5px; display: block; background-color: #ffc107; color: #333; border: none; border-radius: 4px; cursor: pointer; }
        .element-controls .delete-btn { background-color: #dc3545; color: white; }
        
        /* Specific Element Styles (For Preview) */
        .card { border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .card img { max-width: 100px; height: auto; float: right; margin-right: 15px; border-radius: 4px; }
        .card-body { overflow: hidden; }
        
        /* Hiding specific controls based on selection */
        .hidden-control { display: none; }
    </style>
</head>
<body>

    <h1 style="text-align: center; margin-bottom: 30px;">ژنراتور محتوای HTML پیشرفته</h1>

    <div class="main-container">
        <div class="controls">
            <h2>تنظیمات المان</h2>
            <label for="element-type">انتخاب نوع المان:</label>
            <select id="element-type" onchange="updateControls()">
                <option value="button">دکمه (Button)</option>
                <option value="title">عنوان (h2)</option>
                <option value="paragraph">پاراگراف</option>
                <option value="image">تصویر (Image)</option>
                <option value="video">ویدیوی Embed (آپارات/یوتیوب)</option>
                <option value="table">جدول ساده</option>
                <option value="list">لیست بولت‌دار</option>
                <option value="card">کارت (Card)</option>
                <option value="file_link">لینک فایل یا دانلود</option>
            </select>
            
            <div id="common-controls">
                <label for="element-content" id="label-content">متن المان:</label>
                <textarea id="element-content">این یک دکمه است.</textarea>

                <label for="element-link" id="label-link">لینک (URL/آدرس):</label>
                <input type="text" id="element-link" placeholder="http://example.com/..." value="#">
            </div>

            <div id="style-controls">
                <h3 style="margin-top: 25px;">تنظیمات استایل و عملکرد</h3>

                <div id="button-styles">
                    <label for="color-main">رنگ اصلی دکمه:</label><input type="color" id="color-main" value="#007BFF">
                    <label for="color-hover">رنگ در هاور (Hover):</label><input type="color" id="color-hover" value="#0056b3">
                    <label for="color-text">رنگ متن دکمه:</label><input type="color" id="color-text" value="#FFFFFF">
                    <label for="button-action">عملکرد دکمه:</label>
                    <select id="button-action">
                        <option value="link">باز کردن لینک/صفحه</option>
                        <option value="alert">نمایش پیغام (Alert)</option>
                    </select>
                </div>

                <div id="text-styles" class="hidden-control">
                    <label for="text-size">اندازه متن (فونت):</label>
                    <select id="text-size">
                        <option value="normal">متوسط (16px)</option>
                        <option value="large">بزرگ (20px)</option>
                        <option value="small">کوچک (14px)</option>
                    </select>
                    <label for="text-color">رنگ متن:</label><input type="color" id="text-color-value" value="#333333">
                </div>
                
                <div id="table-controls" class="hidden-control">
                    <label for="table-rows">تعداد سطر:</label><input type="number" id="table-rows" value="3" min="1">
                    <label for="table-cols">تعداد ستون:</label><input type="number" id="table-cols" value="2" min="1">
                    <p style="font-size: 12px; color: #666;">متن سلول‌ها را در پیش‌نمایش ویرایش کنید.</p>
                </div>
            </div>
            
            <button class="add-btn" onclick="addElement()">اضافه کردن المان به صفحه</button>
        </div>

        <div class="preview-area" id="live-preview">
            <h2 style="color: #666; margin-top: 0;">پیش‌نمایش زنده صفحه</h2>
        </div>
    </div>

    <div class="output-actions">
        <button class="action-btn" onclick="downloadHtml()" style="background-color: #28a745;">دانلود فایل HTML نهایی</button>
        <button class="action-btn" onclick="clearContent()" style="background-color: #6c757d;">پاک کردن تمام محتوا</button>
    </div>

    <script>
        // --- متغیرها ---
        const livePreview = document.getElementById('live-preview');
        const elementType = document.getElementById('element-type');
        const elementContent = document.getElementById('element-content');
        const elementLink = document.getElementById('element-link');
        const buttonAction = document.getElementById('button-action');
        const colorMain = document.getElementById('color-main');
        const colorHover = document.getElementById('color-hover');
        const colorText = document.getElementById('color-text');
        const textSize = document.getElementById('text-size');
        const textColorValue = document.getElementById('text-color-value');
        const tableRows = document.getElementById('table-rows');
        const tableCols = document.getElementById('table-cols');
        
        // --- منطق نمایش/مخفی کردن کنترل‌ها ---
        function updateControls() {
            const type = elementType.value;
            
            // مخفی کردن همه کنترل‌های استایل
            document.querySelectorAll('#style-controls > div').forEach(div => div.classList.add('hidden-control'));

            // تنظیم نمایش بر اساس نوع المان
            if (type === 'button') {
                document.getElementById('button-styles').classList.remove('hidden-control');
            } else if (['title', 'paragraph', 'list'].includes(type)) {
                document.getElementById('text-styles').classList.remove('hidden-control');
            } else if (type === 'table') {
                document.getElementById('table-controls').classList.remove('hidden-control');
            }

            // تنظیم لیبل‌ها و مقادیر
            const labels = {
                'button': ['متن دکمه:', 'لینک مقصد:'],
                'title': ['متن عنوان:', ''],
                'paragraph': ['متن پاراگراف:', ''],
                'image': ['متن جایگزین (Alt):', 'آدرس تصویر (URL):'],
                'video': ['عنوان ویدیو:', 'لینک یوتیوب/آپارات:'],
                'table': ['عنوان جدول:', ''],
                'list': ['آیتم‌های لیست (با خط جدید جدا کنید):', ''],
                'card': ['عنوان کارت:', 'آدرس تصویر کارت:'],
                'file_link': ['نام فایل:', 'لینک دانلود فایل:']
            };

            document.getElementById('label-content').textContent = labels[type][0];
            document.getElementById('label-link').textContent = labels[type][1];
            elementLink.parentNode.style.display = labels[type][1] ? 'block' : 'none';
        }

        // --- تابع اصلی اضافه کردن المان ---
        function addElement() {
            const type = elementType.value;
            const content = elementContent.value || 'محتوای خالی';
            const link = elementLink.value || '#';
            let htmlCode = '';

            // تولید استایل‌های مشترک دکمه برای هاور
            const buttonHoverStyle = `
                onmouseover="this.style.backgroundColor='${colorHover.value}'" 
                onmouseout="this.style.backgroundColor='${colorMain.value}'"
            `;
            const buttonBaseStyle = `
                background-color: ${colorMain.value}; 
                color: ${colorText.value}; 
                padding: 10px 20px; 
                border: none; 
                border-radius: 5px; 
                cursor: pointer;
            `;

            // تولید استایل‌های متنی
            const size = textSize.value;
            const color = textColorValue.value;
            let fontSize, h2Size;
            if (size === 'large') { fontSize = '18px'; h2Size = '28px'; }
            else if (size === 'small') { fontSize = '14px'; h2Size = '20px'; }
            else { fontSize = '16px'; h2Size = '24px'; }
            

            switch (type) {
                case 'button':
                    if (buttonAction.value === 'alert') {
                        htmlCode = `<button ${buttonHoverStyle} onclick="alert('${content} کلیک شد!')" style="${buttonBaseStyle}">${content}</button>`;
                    } else { // link (external or internal link)
                        htmlCode = `<a href="${link}" target="_blank" ${buttonHoverStyle} style="text-decoration: none; display: inline-block; ${buttonBaseStyle}">${content}</a>`;
                    }
                    break;

                case 'title':
                    htmlCode = `<h2 style="font-size: ${h2Size}; color: ${color}; margin: 15px 0;">${content}</h2>`;
                    break;

                case 'paragraph':
                    htmlCode = `<p style="font-size: ${fontSize}; color: ${color}; line-height: 1.6; margin: 15px 0;">${content}</p>`;
                    break;
                
                case 'image':
                    htmlCode = `<img src="${link}" alt="${content}" style="max-width: 100%; height: auto; display: block; margin: 15px 0; border-radius: 4px;">`;
                    break;

                case 'video':
                    let videoSrc = link;
                    if (link.includes('youtube.com/watch?v=')) { videoSrc = link.replace('watch?v=', 'embed/'); } 
                    else if (link.includes('youtu.be/')) { videoSrc = link.replace('youtu.be/', 'www.youtube.com/embed/'); }
                    // توجه: تبدیل لینک آپارات معمولاً به API اختصاصی نیاز دارد، اما برای سادگی، لینک مستقیم را استفاده می‌کنیم.
                    
                    htmlCode = `
                        <div style="margin: 15px 0;">
                            <h3 style="color: #444;">${content}</h3>
                            <iframe width="560" height="315" src="${videoSrc}" frameborder="0" allowfullscreen style="max-width: 100%;"></iframe>
                        </div>
                    `;
                    break;
                
                case 'table':
                    const rows = parseInt(tableRows.value) || 3;
                    const cols = parseInt(tableCols.value) || 2;
                    let tableHtml = `<h3 style="color: #444;">${content}</h3><table style="width: 100%; border-collapse: collapse;"><thead><tr>`;
                    
                    for (let i = 0; i < cols; i++) { tableHtml += `<th style="border: 1px solid #ccc; padding: 8px; background-color: #f2f2f2;">سرستون ${i + 1}</th>`; }
                    tableHtml += `</tr></thead><tbody>`;

                    for (let i = 0; i < rows; i++) {
                        tableHtml += `<tr>`;
                        for (let j = 0; j < cols; j++) {
                            // قابلیت ویرایش مستقیم در پیش نمایش
                            tableHtml += `<td style="border: 1px solid #ccc; padding: 8px;" contenteditable="true">ردیف ${i + 1}, ستون ${j + 1}</td>`;
                        }
                        tableHtml += `</tr>`;
                    }
                    tableHtml += `</tbody></table>`;
                    htmlCode = tableHtml;
                    break;

                case 'list':
                    const items = content.split('\n').filter(item => item.trim() !== '');
                    const listItems = items.map(item => `<li style="margin-right: 15px;">${item.trim()}</li>`).join('');
                    htmlCode = `<ul style="font-size: ${fontSize}; color: ${color}; margin: 15px 0; padding-right: 20px;">${listItems}</ul>`;
                    break;
                
                case 'card':
                    htmlCode = `
                        <div class="card">
                            <img src="${link}" alt="${content}" style="width: 100px; height: 100px; object-fit: cover;">
                            <div class="card-body">
                                <h3 style="margin-top: 0; color: #007BFF;">${content}</h3>
                                <p style="font-size: 14px; color: #555;">این قسمت برای توضیح محصول یا خدمات شماست.</p>
                            </div>
                        </div>
                    `;
                    break;
                
                case 'file_link':
                    htmlCode = `<a href="${link}" download="${content}" style="display: block; margin: 10px 0; color: #007BFF; text-decoration: underline;">دانلود فایل: ${content}</a>`;
                    break;

                default:
                    return;
            }

            // ساخت کانتینر برای نمایش زنده و کنترل‌ها
            const elementWrapper = document.createElement('div');
            elementWrapper.className = 'page-element';
            elementWrapper.dataset.html = htmlCode; 

            // برای المان‌هایی مثل جدول، قابلیت ویرایش در پیش‌نمایش را فعال می‌کنیم
            const isContentEditable = type !== 'table';

            elementWrapper.innerHTML = `
                <div class="element-controls">
                    <button onclick="moveElement(this.parentNode.parentNode, 'up')">▲ بالا</button>
                    <button onclick="moveElement(this.parentNode.parentNode, 'down')">▼ پایین</button>
                    <button class="delete-btn" onclick="deleteElement(this.parentNode.parentNode)">حذف</button>
                </div>
                <div class="element-content" contenteditable="${isContentEditable ? 'true' : 'false'}" onblur="updateHtmlData(this.parentNode)">${htmlCode}</div>
            `;
            
            livePreview.appendChild(elementWrapper);
            livePreview.scrollTop = livePreview.scrollHeight;
        }

        // --- توابع مدیریت المان‌ها ---

        // ذخیره تغییرات محتوایی (مخصوصاً برای جدول) قبل از دانلود
        function updateHtmlData(elementWrapper) {
            const contentDiv = elementWrapper.querySelector('.element-content');
            // فقط محتوای داخلی را برای ذخیره نهایی به‌روز می‌کنیم
            elementWrapper.dataset.html = contentDiv.innerHTML;
        }
        
        function moveElement(element, direction) {
            const currentContainer = element.parentNode;
            const elements = Array.from(currentContainer.querySelectorAll('.page-element'));
            const currentIndex = elements.indexOf(element);

            if (direction === 'up' && currentIndex > 0) {
                currentContainer.insertBefore(element, elements[currentIndex - 1]);
            } else if (direction === 'down' && currentIndex < elements.length - 1) {
                currentContainer.insertBefore(element, elements[currentIndex + 2]);
            }
        }
        
        function deleteElement(element) {
            element.remove();
        }

        function clearContent() {
            livePreview.innerHTML = '<h2 style="color: #666; margin-top: 0;">پیش‌نمایش زنده صفحه</h2>';
        }

        // --- تابع دانلود فایل HTML نهایی ---
        function downloadHtml() {
            // به‌روزرسانی نهایی محتوای ویرایش شده (مانند جدول)
            Array.from(livePreview.querySelectorAll('.page-element')).forEach(updateHtmlData);
            
            const elements = Array.from(livePreview.querySelectorAll('.page-element'));
            const contentToDownload = elements.map(el => el.dataset.html).join('\n    ');

            // استایل‌های عمومی CSS برای خروجی نهایی
            const finalStyles = `
        body { font-family: Tahoma, sans-serif; padding: 20px; line-height: 1.6; }
        h2, h3, p { color: #333; margin: 15px 0; }
        /* Card Styles */
        .card { border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); overflow: auto; }
        .card img { float: right; margin-right: 15px; border-radius: 4px; object-fit: cover; }
        /* List Styles */
        ul { margin: 15px 0; padding-right: 20px;}
        /* Table Styles */
        table { width: 100%; border-collapse: collapse; margin: 15px 0; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: right; }
        th { background-color: #f2f2f2; }
        /* Link/File Download */
        a[download] { display: block; margin: 10px 0; color: #007BFF; text-decoration: underline; }
    `;
            
            const finalHtml = `
<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>صفحه تولید شده</title>
    <style>
${finalStyles}
    </style>
</head>
<body>
    ${contentToDownload}
</body>
</html>
            `;
            
            // ایجاد فایل قابل دانلود
            const blob = new Blob([finalHtml], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'My_Advanced_WebPage.html';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        // اجرای اولیه برای تنظیم کنترل‌ها
        updateControls();
    </script>
</body>
</html>
